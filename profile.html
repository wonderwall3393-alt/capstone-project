<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Sphinx Net</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./style/style.css">
    <link rel="stylesheet" href="./style/responsive.css">
    <link rel="stylesheet" href="./style/profile.css">
    <link rel="shortcut icon" href="./assets/images/Sphinx_Net_Logo-removebg-preview (1).png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="logo-container" id="logoContainer">
            <img src="./assets/images/Sphinx Net Logo.png" alt="logo" height="40">
            <h3>Sphinx <span>Net.</span></h3>
        </div>
        <nav class="navigasi-container" id="navContainer">
            <ul>
                <li><a href="./beranda.html">Beranda</a></li>
                <li><a href="./package.html">Paket</a></li>
                <li><a href="">Informasi</a></li>
                <li><a href="./about.html">Tentang Kita</a></li>
            </ul>
            <div class="button-SU-SI" id="buttonSU_SI">
                <a class="button-login" href="./login.html">Masuk</a>
                <a class="button-signup" href="./signup.html">Daftar</a>
            </div>
            <div class="user-profile" id="userProfile" style="display: none;">
                <div class="profile-icon" onclick="goToProfile()">
                    <i class="fa-solid fa-user"></i>
                    <span id="userName">User</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </nav>
        <label class="box1" id="box1">
            <input type="checkbox" id="menu">
        </label>
    </header>

    <a href="javascript:history.back()" class="back-btn">
        <i class="fas fa-arrow-left"></i>
        Kembali
    </a>

    <div class="profile-container">
        <div class="profile-content">
            <!-- Profile Information Card -->
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-info">
                        <h2 id="userNameDisplay">Loading...</h2>
                        <p>Member since <span id="memberSince">Loading...</span></p>
                    </div>
                </div>

                <div class="profile-details">
                    <h3>Informasi Akun</h3>
                    <div class="info-row">
                        <span class="info-label">Email</span>
                        <span class="info-value" id="userEmail">Loading...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Telepon</span>
                        <span class="info-value" id="userPhone">Loading...</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Total Surveys</span>
                        <span class="info-value" id="surveyCount">Loading...</span>
                    </div>
                </div>

                <div class="current-package" id="currentPackageSection" style="display: none;">
                    <h4>Paket Aktif</h4>
                    <h3 id="packageName">-</h3>
                    <p id="packagePrice">-</p>
                </div>
            </div>

            <!-- Package Usage Chart Card -->
            <div class="profile-card">
                <h3 class="chart-title">Penggunaan Paket</h3>
                <div class="chart-container">
                    <canvas id="usageChart"></canvas>
                </div>
                <p style="text-align: center; margin-top: 15px; color: #666;">
                    Berdasarkan preferensi dan kebiasaan penggunaan Anda
                </p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthentication();
        });

        function checkAuthentication() {
            const currentUser = localStorage.getItem('currentUser');

            if (!currentUser) {
                window.location.href = './login.html';
                return;
            }

            const user = JSON.parse(currentUser);
            loadUserProfile(user);
            loadUsageChart(user);
        }

        function loadUserProfile(user) {
            // Set user avatar with first letter of name
            const avatar = document.getElementById('profileAvatar');
            const firstLetter = (user.name || user.email || 'U').charAt(0).toUpperCase();
            avatar.innerHTML = firstLetter;

            // Set user information
            document.getElementById('userNameDisplay').textContent = user.name || user.email;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userPhone').textContent = user.phone || 'Belum diisi';
            document.getElementById('surveyCount').textContent = user.survey_count || '0';

            // Set member since date
            if (user.created_at) {
                const date = new Date(user.created_at);
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                document.getElementById('memberSince').textContent = date.toLocaleDateString('id-ID', options);
            } else {
                document.getElementById('memberSince').textContent = 'Baru saja';
            }

            // Show current package if exists
            if (user.package) {
                document.getElementById('currentPackageSection').style.display = 'block';
                document.getElementById('packageName').textContent = user.package;
                // You might want to fetch package details from the server
            }
        }

        function loadUsageChart(user) {
            const ctx = document.getElementById('usageChart').getContext('2d');

            // Default usage data (in real app, this would come from server)
            const usageData = {
                labels: ['Streaming', 'Browsing', 'Gaming', 'Sosial Media', 'Lainnya'],
                datasets: [{
                    label: 'Penggunaan Data',
                    data: [30, 25, 20, 15, 10],
                    backgroundColor: [
                        '#EB3F3F',
                        '#FF6B6B',
                        '#4ECDC4',
                        '#45B7D1',
                        '#96CEB4'
                    ],
                    borderWidth: 0
                }]
            };

            new Chart(ctx, {
                type: 'pie',
                data: usageData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    family: 'Inter',
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>

    <!-- Scripts -->
    <script src="./script/auth.js"></script>
</body>
</html>